name: ((DEPLOYMENT_NAME))

releases:
- name: garden-runc
  url: ((DEPLOYMENT_RELEASE_DIR))
  version: create
- name: bpm
  version: latest

stemcells:
- alias: stemcell
  os: ((CF_STEMCELL_OS))
  version: latest

instance_groups:
- name: gats
  instances: 1
  vm_type: ((CF_VM_TYPE))
  networks:
  - name: ((CF_NETWORK))
  azs: [((CF_AZ))]
  stemcell: stemcell
  jobs:
  - name: bpm
    release: bpm
  - name: garden
    release: garden-runc
    properties:
      garden:
        listen_network: tcp
        listen_address: 0.0.0.0:7777
        debug_listen_address: 0.0.0.0:17013
        log_level: debug
        experimental_cpu_throttling: ((WITH_CPU_THROTTLING))
        bpm:
          enabled: ((WITH_BPM))
        destroy_containers_on_start: ((WITH_BPM))
        network_plugin: ((WITH_NOOP_NETWORK_PLUGIN))
        experimental_rootless_mode: ((WITH_ROOTLESS_MODE))
        containerd_mode: ((WITH_CONTAINERD_MODE))
        experimental_use_containerd_mode_for_processes: ((WITH_COTAINERD_FOR_PROCESSES_MODE))
      grootfs:
        skip_mount: ((WITH_ROOTLESS_MODE))
  - name: gats
    release: garden-runc
    properties:
      cpu_throttling: ((WITH_CPU_THROTTLING))
      rootless: ((WITH_ROOTLESS_MODE))
      containerd_for_processes: ((WITH_COTAINERD_FOR_PROCESSES_MODE))
- name: gpats
  instances: 1
  vm_type: ((CF_VM_TYPE))
  networks:
  - name: ((CF_NETWORK))
  azs: [((CF_AZ))]
  stemcell: stemcell
  jobs:
  - name: bpm
    release: bpm
  - name: garden
    release: garden-runc
    properties:
      garden:
        listen_network: tcp
        listen_address: 0.0.0.0:7777
        debug_listen_address: 0.0.0.0:17013
        log_level: debug
  - name: gpats
    release: garden-runc

update:
  canaries: 1
  max_in_flight: 3
  canary_watch_time: 1000-240000
  update_watch_time: 1000-240000
